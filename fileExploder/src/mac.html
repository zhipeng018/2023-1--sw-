<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="mac.css" />
    <title>Document</title>
</head>
<body>
    <div class = "header">
        <h1>
          <img src="./resources/logo.PNG" id = "logo" alt="logo" height="70" width="=180" >
          <button class="login" onclick="signin()"></button>
          <script>
            function signin(){
              window.open('login.html',"Sign in","wdith=420,height=420");  
            }
          </script>
        </h1>
    </div>
    <div class="file_List">
      <div class="navbar">
        <ul class="file">
          <li>
            <button id="backButton">Back</button>
            <script>
              backButton.addEventListener('click', () => {
                const currentPath = fileList.getAttribute('data-path');
                const parentPath = path.dirname(currentPath);
                if(parentPath !== '/'){
                  updateFileList(parentPath);
                }
              })
            </script>
          </li>
          <li>
            <button id="createFile">add</button>
            <script src="file-add.js">
            </script>
          </li>
          <li><button id="delete">delete</button></li>
        </ul>
        <ul class="git"> 
          <li>
            <button id="git">git</button>
            <script>
            document.getElementById('git').addEventListener('click', function() {
              const normalizedCurrentPath = getCurrentPath();
              gitOperations.initGit(normalizedCurrentPath);
            });
            </script>
            
          </li>
          <li>
            <button id="commit">commit</button>
            <script>
              document.getElementById('commit').addEventListener('click', async function() {
                const { ipcRenderer } = require('electron');
                const normalizedCurrentPath = getCurrentPath();
                ipcRenderer.send('prompt', {
                title: 'Commit Message',
                label: 'Enter your commit message:',
                value: 'Default commit message',
                path: normalizedCurrentPath
                });
                await updateHistory();
              });
            </script>
          </li>
          <li>
            <button id ="push">push</button>
            <script>
              document.getElementById('push').addEventListener('click', async function() {
                const normalizedCurrentPath = getCurrentPath();
                gitOperations.pushChanges(normalizedCurrentPath);
              });
              await updateHistory();
              </script>
          </li>
          <li>
            <button id="pull">pull</button>
            <script>
              document.getElementById('pull').addEventListener('click', async function() {
                const normalizedCurrentPath = getCurrentPath();
                gitOperations.pullRepo(normalizedCurrentPath);
              }); 
              await updateHistory(); 
            </script>
          </li>
          <li>
            <button id="fetch">fetch</button>
            <script>
              document.getElementById('fetch').addEventListener('click', async function() {
                const normalizedCurrentPath = getCurrentPath();
                gitOperations.fetchRepo(normalizedCurrentPath);
              });
              await updateHistory(); 
              </script>
          </li>

          <form action="">
              <div>
                <label>
                  <img src="./resources/search.PNG" id= "search" alt="search" height="30" width="30">
                </label>
                <input type="text" name="filename" placeholder="Search">
              </div>    
          </form>
        </ul>
      </div>
      <p id="currentPath"></p>
      <div class="sidebar">
        <ul id="fileList">

        </ul>
      </div>

      <div class="main-content">

      
        <div class = "history">
          <ul id = "history">
            <script>
              // 在初始化时获取 historyList 的引用
              const historyList = document.getElementById('history');
            
              async function updateHistory() {
                const normalizedCurrentPath = getCurrentPath();
                const log = await gitOperations.getLog(normalizedCurrentPath);
            
                historyList.innerHTML = ''; // 清空历史列表
            
                // 创建一个 DocumentFragment 来存储新的列表项
                const fragment = document.createDocumentFragment();
            
                log.all.forEach(commit => {
                  const listItem = document.createElement('p');
                  listItem.textContent = `${commit.hash}: ${commit.message}`;
            
                  // 将新的列表项添加到 fragment 中
                  fragment.appendChild(listItem);
                });
            
                // 一次性将所有新的列表项添加到 historyList 中
                historyList.appendChild(fragment);
              }
            
              // 在需要更新历史信息的地方调用 updateHistory() 函数
            </script>
            
              
          </ul>
        </div>
         
        <div class="filePrint">
                <ul id="filePrint">

                </ul>

        </div>

            
      </div>

      <script src="./render/file_management.js"></script>
      <script src="./git/git_operations.js"></script>
      <script src="./addEventListeners.js"></script>
    </div>   
</body>
</html>
